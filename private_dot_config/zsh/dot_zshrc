bindkey -e

[[ -z ${(M)path:#$XDG_BIN_HOME} ]] && path=($XDG_BIN_HOME $path)

HISTFILE=$XDG_DATA_HOME/zsh/history
fpath+=($XDG_DATA_HOME/zsh/functions)

eval "$(sheldon source)"
eval "$(mise activate zsh)"

autoload -Uz compinit && compinit
autoload -Uz promptinit && promptinit
autoload -Uz zmv

PROMPT=${PROMPT:s/%(!.#.$)/$prompt_newline%(!.#.$)} # break a line before the prompt symbol ($, #)

export LESS="$LESS --quit-if-one-screen --RAW-CONTROL-CHARS"
export RUBY_CFLAGS='-Og -march=native -flto=auto -fno-fat-lto-objects -fno-plt -Werror=odr -Werror=lto-type-mismatch -Werror=strict-aliasing'

hash -d github=$HOME/Repositories/github.com

function fzf-ghq-cd() {
  local repo=$(ghq list | fzf)

  if [[ -n "$repo" ]]; then
    cd "$(ghq root)/$repo"
    zle reset-prompt
  fi
}

zle -N fzf-ghq-cd

bindkey '^g' fzf-ghq-cd

case $OSTYPE in
  linux*)
    export PGUSER=postgres
    export UNZIP='-O cp932'
    ;;
  darwin*)
    export EDITOR=nvim
    alias vi=nvim
    ;;
esac
